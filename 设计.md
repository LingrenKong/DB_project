# 大作业设计

设计文档
* 前言
* 业务描述
* 数据库设计（ER图）
* 应用系统模块设计、以及功能点描述
* 系统实现描述
* 总结
* 参考文献和资料

## 前言

本作业旨在完成一个图书管理系统，从而实践学习到的数据库知识

## 业务描述

实现一个学校图书馆管理系统，包含
* 管理学生和老师（管理借阅者），并提供状态展示
* 管理已有图书，并提供状态展示
* 实现借阅与归还的操作

## 数据库设计（ER图）

### ER图







### 解释

包含2个实体和1个联系：

* 实体：
  * 借阅者：id（学生教师号）、姓名、密码、用户类型、在借书数目、备注、是否被禁用
  * 图书：id（书号）、书名、简介、类型、作者、出版社、价格、数量、备注、是否下架
* 联系：
  * 借阅：借出时间、借阅期限、归还时间、状态、备注



## 应用系统模块设计、功能点描述

功能整体分为两块：读者的操作（借书还书等）、管理员的操作（查看/修改-图书/借阅数据）

读者操作：

* 注册
* 借阅操作（此处操作认为在网页点击即可借还）：
  * 借书
  * 还书
  * 续借
* 注销

管理操作：

* 信息查阅：
  * 显示当前库内图书的信息
* 图书管理
  * 购入
  * 下架



## 系统描述实现

### python环境

使用的是venv虚拟环境，python为3.7版本

继承了原本环境的包，同时在虚拟环境添加了

```
pip freeze > requirements.txt
```

安装的依赖以及使用这个方法导出到文件中，可以直接用

```
pip install -r requirements/requirements.txt
```

来安装到自己的电脑中（但是建议别全安装，因为里面有一些是和项目无关的库，比如jupyter）

本环境安装了`flask-bootstrap`，但是在实际使用中采用的是boostrap的本地CSS而不是flask模板（由于boostrap4是适应移动端的，所以电脑观察体验不是特别好）

### 数据库配置

```mssql
CREATE TABLE Userlist
(
    id char(11) PRIMARY KEY,
    Uname nvarchar(10) NOT NULL,
    Upassword nvarchar(20) NOT NULL,
    Utype nvarchar(10),
    Uget int NOT NULL,
    more nvarchar(2000),
    Urestrict bit NOT NULL,
)
```

```mssql
CREATE TABLE book(
    id char(13) PRIMARY KEY,
    Bname nvarchar(100) NOT NULL,
    brief nvarchar(1000) NOT NULL,
    Btype nvarchar(20),
    author nvarchar(100) NOT NULL,
    Press nvarchar(100) NOT NULL,
    price numeric(5,2) NOT NULL,
    num int,
    more nvarchar(2000),
    removed bit NOT NULL
)
```

```mssql
CREATE TABLE borrow(
    id int PRIMARY KEY,
    user char(11),
    book char(10),
    outDate date NOT NULL,
    maxtime int NOT NULL,
    returnDate date NOT NULL,
    type nvarchar(10),
    more nvarchar(2000),
    FOREIGN KEY (user) REFERENCES user(id) 
    ON DELETE CASCADE
    ON UPDATE CASCADE,
    FOREIGN KEY (book) REFERENCES book(id) 
    ON DELETE CASCADE
    ON UPDATE CASCADE,  
)
```





### 网页模板设计

在本地`static`文件夹下载了`boostrap4`的前端`css`和`js`文件，加载到模板中。

模板使用的是框架配套的`jinja2`，各个网页通过继承`base.html`文件来达成各自的效果：

* `base.html`：基HTML文件，提供了对于整体网页架构的约束，含有几个块（block）
  * site_name：网页名字（HTML-header部分），应该在模板中替换
  * header：网页的顶部标题
  * left_body：左侧侧边栏，占据`3/12`的比例，用来放置跳转连接
  * right_body：右侧主体，放网页的主体内容

```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<script src="https://how2j.cn/study/js/jquery/2.0.0/jquery.min.js"></script>
<!--<link href="https://how2j.cn/study/css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">-->
<!--<script src="https://how2j.cn/study/js/bootstrap/3.3.6/bootstrap.min.js"></script>-->
<link href="{{ url_for('static', filename = 'css/bootstrap.min.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename = 'js/bootstrap.min.js') }}"></script>

<html>
  <head>
    <title>{% block site_name %}网页名字，应该在模板中替换{% endblock %}</title>
  </head>
  <body>
    <div class="container-fluid">

    <div class="row">
      <div class="col-md-12">
        <h1 class="text-center">
          {% block header %}顶部标题{% endblock %}
        </h1>
      </div>
    </div>


    <div class="row">
      <div class="col-md-3">
      {% block left_body %}
        <ul>
          <li class="list-item">
            左侧列表栏
          </li>
          <li class="list-item">
            建议每次都替换
          </li>
        </ul>
      {% endblock %}
      </div>
      <div class="col-md-9">
      {% block right_body %}
        <p>
            右侧版面主题
        </p>
      {% endblock %}
      </div>

    </div>
  </div>
  </body>
</html>
```



### 初始数据

首先随机生成一些学生和老师（借阅者）：

* 姓名是利用网上的起名器，都是三个字的，存在Sname文件里面
* id分老师学生，是递增输入
* 老师学生是随机设定的，用于后续不同权限
* 备注暂时置空，被禁用设置为0（没有被禁）
* 功能在函数`randUser(n)`实现



然后生成一批图书：

* 此处由于图书要比较高的真实性，所以采用豆瓣的数据
* 先手动从豆瓣摘取一些数据，存储在本地
* 然后将图书数据插入数据库







### 功能测试



## 总结



## 参考文献和资料

虚拟环境的配置：

* https://blog.csdn.net/guying4875/article/details/80905472
* https://blog.csdn.net/happy_bigqiang/article/details/51168614?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-4
* https://blog.csdn.net/Growing_hacker/article/details/89518534

boostrap参考：

* https://how2j.cn/k/boostrap/boostrap-setup/539.html如何使用boostrap（不涉及flask）
* https://v4.bootcss.com/docs/getting-started/download/ boostrap安装到本地
* https://www.layoutit.com/build 网页设计

flask整体教程：

* https://www.w3cschool.cn/flask/ W3教程
* https://blog.csdn.net/hanbo6/article/details/82563015用户登录功能的session方法

SQL server相关：

* https://docs.microsoft.com/zh-cn/sql/relational-databases/tables/create-foreign-key-relationships?view=sql-server-ver15
  创建外键关系

数据资源：

* https://www.qqxiuzi.cn/zh/xingming/姓名生成器
* 豆瓣读书

https://wenku.baidu.com/view/7c474d6491c69ec3d5bbfd0a79563c1ec4dad70d.html一份其他人的设计文档

